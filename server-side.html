<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Server side | Scala.js SPA-tutorial</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.5.2">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="gitbook/style.css">
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-highlight/website.css">
        
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-search/search.css">
        
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-fontsettings/website.css">
        
    
    

        
    
    
    <link rel="next" href="./testing.html" />
    
    
    <link rel="prev" href="./autowire-and-boopickle.html" />
    

        
    </head>
    <body>
        
        
    <div class="book" data-level="2.2" data-chapter-title="Server side" data-filepath="server-side.md" data-basepath="." data-revision="Sun Feb 14 2016 00:17:43 GMT+0200 (FLE Standard Time)">
    

<div class="book-summary">
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="./index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="getting-started.html">
            
                
                    <a href="./getting-started.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        Getting started
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2" data-path="application-structure.html">
            
                
                    <a href="./application-structure.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        Application structure
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1" data-path="the-client.html">
            
                
                    <a href="./the-client.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                        The Client
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.1" data-path="routing.html">
            
                
                    <a href="./routing.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.1.</b>
                        
                        Routing
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.1.2" data-path="main-menu.html">
            
                
                    <a href="./main-menu.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.2.</b>
                        
                        Main menu
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.1.3" data-path="dashboard.html">
            
                
                    <a href="./dashboard.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.3.</b>
                        
                        Dashboard
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.1.4" data-path="css-in-scala.html">
            
                
                    <a href="./css-in-scala.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.4.</b>
                        
                        CSS in Scala
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.1.5" data-path="integrating-javascript-components.html">
            
                
                    <a href="./integrating-javascript-components.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.5.</b>
                        
                        Integrating JavaScript components
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.1.6" data-path="todo-module-and-data-flow.html">
            
                
                    <a href="./todo-module-and-data-flow.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.6.</b>
                        
                        Todo module and data flow
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.1.7" data-path="autowire-and-boopickle.html">
            
                
                    <a href="./autowire-and-boopickle.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.7.</b>
                        
                        Autowire and BooPickle
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter active" data-level="2.2" data-path="server-side.html">
            
                
                    <a href="./server-side.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                        Server side
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3" data-path="testing.html">
            
                
                    <a href="./testing.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        Testing
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4" data-path="debugging.html">
            
                
                    <a href="./debugging.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        Debugging
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5" data-path="logging.html">
            
                
                    <a href="./logging.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        Logging
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6" data-path="sbt-build-definition.html">
            
                
                    <a href="./sbt-build-definition.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.</b>
                        
                        SBT build definition
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1" data-path="using-resources-from-webjars.html">
            
                
                    <a href="./using-resources-from-webjars.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.1.</b>
                        
                        Using resources from WebJars
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.2" data-path="production-build.html">
            
                
                    <a href="./production-build.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.2.</b>
                        
                        Production build
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="7" data-path="faq.html">
            
                
                    <a href="./faq.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.</b>
                        
                        FAQ
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8" data-path="what-next.html">
            
                
                    <a href="./what-next.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.</b>
                        
                        What next?
                    </a>
            
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    Published with GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="./" >Scala.js SPA-tutorial</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="server-side">Server side</h1>
<p>The tutorial server is very simplistic and does not represent a typical Play application, but it&apos;s enough to provide some basic support
for the client side. Routing logic on the server side is defined using a Play controller </p>
<pre><code class="lang-scala"><span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">Application</span> <span class="hljs-keyword"><span class="hljs-keyword">extends</span></span> <span class="hljs-title">Controller</span> {</span>
  <span class="hljs-function"><span class="hljs-keyword">val</span> <span class="hljs-title">apiService</span> =</span> <span class="hljs-keyword">new</span> <span class="hljs-type">ApiService</span>()

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">index</span> =</span> <span class="hljs-type">Action</span> {
    <span class="hljs-type">Ok</span>(views.html.index(<span class="hljs-string">&quot;SPA tutorial&quot;</span>))
  }

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">autowireApi</span>(</span>path: <span class="hljs-type">String</span>) = <span class="hljs-type">Action</span>.async(parse.raw) {
    <span class="hljs-keyword">implicit</span> request =&gt;
      println(s<span class="hljs-string">&quot;Request path: $path&quot;</span>)
      <span class="hljs-comment">// get the request body as Array[Byte]</span>
      <span class="hljs-function"><span class="hljs-keyword">val</span> <span class="hljs-title">b</span> =</span> request.body.asBytes(parse.<span class="hljs-type">UNLIMITED</span>).get

      <span class="hljs-comment">// call Autowire route</span>
      <span class="hljs-type">Router</span>.route[<span class="hljs-type">Api</span>](apiService)(
        autowire.<span class="hljs-type">Core</span>.<span class="hljs-type">Request</span>(path.split(<span class="hljs-string">&quot;/&quot;</span>), <span class="hljs-type">Unpickle</span>[<span class="hljs-type">Map</span>[<span class="hljs-type">String</span>, <span class="hljs-type">ByteBuffer</span>]].fromBytes(<span class="hljs-type">ByteBuffer</span>.wrap(b)))
      ).map(buffer =&gt; {
        <span class="hljs-function"><span class="hljs-keyword">val</span> <span class="hljs-title">data</span> =</span> <span class="hljs-type">Array</span>.ofDim[<span class="hljs-type">Byte</span>](buffer.remaining())
        buffer.get(data)
        <span class="hljs-type">Ok</span>(data)
      })
  }

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">logging</span> =</span> <span class="hljs-type">Action</span>(parse.anyContent) {
    <span class="hljs-keyword">implicit</span> request =&gt;
      request.body.asJson.foreach { msg =&gt;
        println(s<span class="hljs-string">&quot;CLIENT - $msg&quot;</span>)
      }
      <span class="hljs-type">Ok</span>(<span class="hljs-string">&quot;&quot;</span>)
  }
}
</code></pre>
<p>The main HTML page and related resources are provided by Play&apos;s template engine from the <code>twirl</code> directory.
The interesting part is handling <code>api</code> requests using Autowire router. Like on the client side, Autowire takes care of the complicated stuff
so you just need to plug it in and let it do its magic. Boopickle takes care of deserializing the request and serializing the response into binary. </p>
<p>The <code>ApiService</code> is just a normal class and it doesn&apos;t need to concern itself with
serialization or URL request path mappings. It just implements the same <code>Api</code> as it used on the client side. Simple, eh!</p>
<pre><code class="lang-scala"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApiService</span> <span class="hljs-keyword"><span class="hljs-keyword">extends</span></span> <span class="hljs-title">Api</span> {</span>
  <span class="hljs-keyword">var</span> todos = <span class="hljs-type">Seq</span>(
    <span class="hljs-type">TodoItem</span>(<span class="hljs-string">&quot;1&quot;</span>, <span class="hljs-string">&quot;Wear shirt that says &apos;Life&apos;. Hand out lemons on street corner.&quot;</span>, <span class="hljs-type">TodoLow</span>, <span class="hljs-literal">false</span>),
    <span class="hljs-type">TodoItem</span>(<span class="hljs-string">&quot;2&quot;</span>, <span class="hljs-string">&quot;Make vanilla pudding. Put in mayo jar. Eat in public.&quot;</span>, <span class="hljs-type">TodoNormal</span>, <span class="hljs-literal">false</span>),
    <span class="hljs-type">TodoItem</span>(<span class="hljs-string">&quot;3&quot;</span>, <span class="hljs-string">&quot;Walk away slowly from an explosion without looking back.&quot;</span>, <span class="hljs-type">TodoHigh</span>, <span class="hljs-literal">false</span>),
    <span class="hljs-type">TodoItem</span>(<span class="hljs-string">&quot;4&quot;</span>, <span class="hljs-string">&quot;Sneeze in front of the pope. Get blessed.&quot;</span>, <span class="hljs-type">TodoNormal</span>, <span class="hljs-literal">true</span>)
  )

  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">motd</span>(</span>name: <span class="hljs-type">String</span>): <span class="hljs-type">String</span> = s<span class="hljs-string">&quot;Welcome to SPA, $name! Time is now ${new Date}&quot;</span>

  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">getTodos</span>(</span>): <span class="hljs-type">Seq</span>[<span class="hljs-type">TodoItem</span>] = {
    <span class="hljs-comment">// provide some fake Todos</span>
    println(s<span class="hljs-string">&quot;Sending ${todos.size} Todo items&quot;</span>)
    todos
  }

  <span class="hljs-comment">// update a Todo</span>
  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">updateTodo</span>(</span>item: <span class="hljs-type">TodoItem</span>): <span class="hljs-type">Seq</span>[<span class="hljs-type">TodoItem</span>] = {
    <span class="hljs-comment">// TODO, update database etc :)</span>
    <span class="hljs-keyword">if</span>(todos.exists(_.id == item.id)) {
      todos = todos.collect {
        <span class="hljs-keyword">case</span> i <span class="hljs-keyword">if</span> i.id == item.id =&gt; item
        <span class="hljs-keyword">case</span> i =&gt; i
      }
      println(s<span class="hljs-string">&quot;Todo item was updated: $item&quot;</span>)
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// add a new item</span>
      <span class="hljs-function"><span class="hljs-keyword">val</span> <span class="hljs-title">newItem</span> =</span> item.copy(id = <span class="hljs-type">UUID</span>.randomUUID().toString)
      todos :+= newItem
      println(s<span class="hljs-string">&quot;Todo item was added: $newItem&quot;</span>)
    }
    todos
  }

  <span class="hljs-comment">// delete a Todo</span>
  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">deleteTodo</span>(</span>itemId: <span class="hljs-type">String</span>): <span class="hljs-type">Seq</span>[<span class="hljs-type">TodoItem</span>] = {
    println(s<span class="hljs-string">&quot;Deleting item with id = $itemId&quot;</span>)
    todos = todos.filterNot(_.id == itemId)
    todos
  }
}
</code></pre>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="./autowire-and-boopickle.html" class="navigation navigation-prev " aria-label="Previous page: Autowire and BooPickle"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="./testing.html" class="navigation navigation-next " aria-label="Next page: Testing"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="gitbook/app.js"></script>

    
    <script src="gitbook/plugins/gitbook-plugin-search/lunr.min.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-search/search.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-sharing/buttons.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-fontsettings/buttons.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"highlight":{},"search":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
